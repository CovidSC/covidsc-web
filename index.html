<!DOCTYPE html>
<html>

<head>
      <meta http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma"
      content="no-cache" />
<meta http-equiv="Expires"
      content="0" />
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-53HZNZQ');</script>
    <!-- End Google Tag Manager -->

<script src="script/jquery-3.4.1.min.js"></script>
<script src="script/jquery-dateformat.min.js"></script>


<script src="script/jquery.csv.min.js"></script>

<title>CovidSC - Tracking, Triage, and Support for South Carolinians</title>
<link rel="icon"
      type="image/png"
      href="favicon.png" />
<link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous">

<link rel="stylesheet"
      href="css/custom.css">

    <style>
      /* Always set the map height explicitly to define the size of the div
            * element that contains the map. */
      #map {
            height: 400px;
            width: 600px;
            text-align: center;
      }

      </style>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-53HZNZQ"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
	<nav role="navigation"
     class="navbar">
      <div class="col-4">
        <span><a href='https://covidnearyou.org' target='_covidnearyou'><font size='+1'>Symptom Reporting</font></a><br><font size='-1'>(via covidnearyou.org)</font></span>
      </div>
      <div class="col-2">
        <span><a href="https://www.scdhec.gov/infectious-diseases/viruses/coronavirus-disease-2019-covid-19/monitoring-testing-covid-19" target="_new">SC Cases / Deaths</a>
          <br><div id='SCdataHeader'></div>
      </span>
      </div>
      <div class="col-2">
        <span><a href="https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/cases-in-us.html" target="_new">US Cases / Deaths</a>
          <br><div id='USdataHeader'></div>
      </span>
      </div>
      <div class="col-4">
        <span><a href='https://www.scdhec.gov/infectious-diseases/viruses/coronavirus-disease-2019-covid-19' target="_new">SC DHEC</a></span>
      </div>
  

</nav>

	<main role="main"
      class="main container align-middle">
  <div class="row ">
    <div class="col-sm-12 mx-auto"><br>
      <div id="map" class='mx-auto text-center align-middle'></div>

      <div class="mx-auto text-center align-middle">
        <br><br>
        EMPLOYEE needing help?<br><a href='https://dew.sc.gov/covid-hub' target="_new">CLICK HERE</a><br><br>

        SMALL BUSINESS needing help?<br><a href='https://scsbdc.ecenterdirect.com/signup' target="_new">CLICK HERE</a><br><br><br>
        Learn more about COVID-19 <a href='https://emcrit.org/ibcc/covid19/' target="_emcrit">HERE</a>

<!--
          <table class='align left'>
            <tr><td align='left'>Confirmed cases: </td><td align='left'><div id='SCcases'>(loading)</div></td></tr>
            <tr><td align='left'>Deaths: </td><td align='left'><div id='SCdeaths'>(loading)</div></td></tr>
            <tr><td align='left'>Last Update: </td><td align='left'><div id='LastDataUpdate'>(loading)</div></td></tr>
          </table>          
        -->
      </div>

    </div>
  </div>
</main>

	
	<footer class="footer w-100 position-absolute">
    <div class="container-fluid text-center">
      <div class="row">
        <div class="col-2"><span>&nbsp;</span>
        </div>
        <div class="col-8">
          <span>Powered by <a href='https://hank.ai'>Hank.ai</a> and <a href="https://www.krum.io/">Krumware</a></span>
        </div>
        <div class="col-2"><span><font size='-2'>Version 0.04a</font></span>
        </div>
      </div>
    </div>
  </footer>
  

	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

</body>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBx6seaJUAP-r-6eePDE1IGQCXosHcQZbY"></script>

<script>
  var confirmedCircles = {};
  var deathCircles = {};
	var today = new Date();
	var yesterday = new Date();
	yesterday.setDate(yesterday.getDate()-1);
  
	var tdd = String(today.getDate()).padStart(2, '0');
	var tmm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0
	var ydd = String(yesterday.getDate()).padStart(2, '0');
	var ymm = String(yesterday.getMonth() + 1).padStart(2, '0'); // January is 0
	var tyyyy = today.getFullYear();
	var yyyyy = yesterday.getFullYear();
  
	//var jsonfile = "https://mymed.udifi.com/data/covid_latest.json";
	//var jsonfile = "http://covidsc.com.s3-website.us-east-2.amazonaws.com/data/covid_latest.json";
	//var jsonfile = "https://d3e6xqdw3pm38f.cloudfront.net/data/covid_latest.json";
	var jsonfile = "https://covidsc.com/data/covid_latest.json?v=5";
	//var jsonfile = "data/covid_latest.json";
	console.log('loading json file ' + jsonfile);
  function commas(num, decimalPlaces=0){
    return num.toLocaleString(undefined, {maximumFractionDigits:decimalPlaces})

  }

	fetch(jsonfile)
	.then(response => response.json())
	.then(data => {
	  console.log(data);
    //json = JSON.parse(data);
    var allDeaths = 0;
    var allConfirmed = 0;
    var allDeathsChange = 0;
    var allConfirmedChange = 0;
    var lastDate = yesterday;

    //var confirmedCircles = {}
    //var deathCircles = {}

	  data.forEach((d) => {
      d.LastUpdate = d.LastUpdate.replace(' ', 'T');
      if (d.Country == 'US' && d.State == 'South Carolina' && d.County != 'ALL'){
        if (d.Deaths_Change > 0) { console.log(d.County + ' deaths up ' + d.Deaths_Change); }
        if (d.Confirmed > 0){
          confirmedCircles[d.County] = {
            center: {lat: d.Lat, lng: d.Long},
            population: d.Confirmed * 500,
            header: d.County + ', SC Confirmed Cases',
            content: d.Confirmed + ' confirmed cases (+'+d.Confirmed_Change+' since yesterday)',
            color: '#FF0000'
          };
        }
        if (d.Deaths>0) {
          deathCircles[d.County] = {
            center: {lat: d.Lat, lng: d.Long},
            population: d.Deaths * 700,
            header: d.County + ', SC Deaths',
            content: d.Deaths + ' deaths (+'+d.Deaths_Change+' since yesterday)',
            color: '#0000FF'
          };
        }
      }
      if (d.Country == 'US' && d.State == 'South Carolina' && d.County == 'ALL') {
        console.log(d);
        //document.getElementById("SCcases").innerHTML = d.Confirmed;
        //document.getElementById("SCdeaths").innerHTML = d.Deaths;
        let m = new Date(d.LastUpdate);
        m.setTime(m.getTime()+(-300*60*1000)); //hard convert to eastern time
        console.log("Last update: " + m);
        //let dateString = $.format.date(m, "MMMM d, yyyy @ HH:mm") + " Eastern";
        let dateString = "<br><font size='-2'> as of "+(m.getMonth()+1)+'/'+m.getDate()+' @ '+m.getHours()+":"+m.getMinutes()+'</font>';
        //document.getElementById("LastDataUpdate").innerHTML = m;
        
        document.getElementById('SCdataHeader').innerHTML = commas(d.Confirmed) + ' / ' + commas(d.Deaths) + "<br><font size='-1'>+" + 
          commas(d.Confirmed_Change) + " / +" + commas(d.Deaths_Change) + "</font>" + dateString;
      }      
      if (d.Country == 'US' && d.State == 'ALL'){
        let lastDate = new Date(d.LastUpdate)
        var dateString = "<br><font size='-2'> as of "+(lastDate.getMonth()+1)+'/'+lastDate.getDate()+' @ '+lastDate.getHours()+":"+lastDate.getMinutes()+'</font>'
        document.getElementById('USdataHeader').innerHTML = commas(d.Confirmed) + ' / ' + commas(d.Deaths) + "<br><font size='-1'>+" + 
              commas(d.Confirmed_Change) + " / +" + commas(d.Deaths_Change) + "</font>" + dateString;

        console.log("Deaths: " + d.Deaths + ", Confirmed: " + d.Confirmed)
/*    
        allDeaths += d.Deaths;
        allConfirmed += d.Confirmed;
        allDeathsChange += d.Deaths_Change;
        allConfirmedChange += d.Confirmed_Change;
        let m = new Date(d.LastUpdate);
        if (m > lastDate) { lastDate=m; }
        */
      }
    })
    console.log(confirmedCircles);
    console.log(deathCircles);
    var map = initMap();
    drawCircles(map, confirmedCircles);
    drawCircles(map, deathCircles);
  

	})
  
  </script>
  <script>
    // This example creates circles on the map, representing populations in North
    // America.
    var infoWindow;

    function drawCircles(map, spotmap){

      // Construct the circle for each value in citymap.
      // Note: We scale the area of the circle based on the population.
      for (var spot in spotmap) {
        // Add the circle for this city to the map.
        var spotCircle = new google.maps.Circle({
          strokeColor: spotmap[spot].color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: spotmap[spot].color,
          fillOpacity: 0.35,
          map: map,
          center: spotmap[spot].center,
          radius: Math.sqrt(spotmap[spot].population) * 100,
          clickable: true
        });
        spotmap[spot].contentString = '<div id="content">'+
          '<div id="covidDataInfo">'+
          '</div>'+
          '<h5 id="firstHeading" class="firstHeading">'+spotmap[spot].header+'</h5>'+
          '<div id="bodyContent">'+spotmap[spot].content + 
          '</div>'+
          '</div>';
        //create info window
/*
        google.maps.event.addListener(marker, 'mouseover', (function(marker) {  
           return function() {  
               var content = contentString;  
               infoWindow.setContent(content);  
               infoWindow.open(map, marker);  
           }  
         })(marker));  */

         infoWindow = new google.maps.InfoWindow();
         //console.log('Adding listener for ' + spotmap[spot].contentString);
         //console.log(spotCircle.getCenter());
         google.maps.event.addListener(spotCircle, 'click', (function(spotCircle, spot) {
          return function() {
              infoWindow.setContent(spotmap[spot].contentString);
              infoWindow.setPosition(spotCircle.getCenter());
              infoWindow.open(map);
          }
        })(spotCircle, spot));
        
      }
    }


    function initMap() {
      // Create the map.
      console.log('Drawing map ...')
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 7.1,
        center: {lat: 33.7100, lng: -81.0348},
        mapTypeId: 'terrain'
      });
      //var map = initMap();
      //drawCircles(map, confirmedCircles);
      //drawCircles(map, deathCircles);
      return map;
    }
  </script>
  <!--
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBx6seaJUAP-r-6eePDE1IGQCXosHcQZbY&callback=initMap">
  </script>
-->

</html>